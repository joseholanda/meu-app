<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-request.html">

<dom-module id="meu-slider">
  <style>
    :host {
      display: block;
      @apply(--layout-vertical);
    }
    paper-slider{
      width:100%;
    }
    .linha {
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
    }
    h2{
      color: #ccc;
    }
    .colored {
      background: #4285f4;
      color: #fff;
      width: 250px;
    }
    label {
      margin-left: 10px;
    }
  </style>
  <template>
    <iron-ajax id="ajaxMamada" method="PUT" url="{{url}}" body='{{body}}' on-response="handleAjax" verbose></iron-ajax>

    <h2>Adicionar mamada</h2>
    
    <paper-item >Tempo da mamada: <span>{{tempoDaMamadaString}}</span></paper-item >
    <paper-slider min="1" max="60" pin value="{{tempoDaMamada}}" on-value-change="mudaValor"/></paper-slider>
    
    <br/>
    <paper-item >
      Mama:
    </paper-item >

    <paper-radio-group selected="{{mama}}">
      <paper-radio-button name="E">Esquerda</paper-radio-button>
      <paper-radio-button name="D">Direita</paper-radio-button>
    </paper-radio-group>
    <br/> 

    <paper-item >
      <paper-input floatingLabel label="Data" type="text" value="{{dataDaMamada}}"></paper-input>
    </paper-item>

    <paper-item >
      <paper-input type="text" label="Hora de inÃ­cio" floatingLabel value="{{horaDaMamada}}"></paper-input>
    </paper-item>

    <br/>
    <paper-button raised class="colored" role="button" on-click="adicionarMamada">
      <paper-ripple></paper-ripple>
      <iron-icon icon="check"></iron-icon> Adicionar
    </paper-button>

  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'meu-slider',

    properties: {
      mama: {type:String, value: 'E'},
      dataDaMamada: {type:Date,value: new Date()},
      horaDaMamada: {type:String,value: ""},
      tempoDaMamada: Number,
      tempoDaMamadaString : String,
      url:String,
      body: String,
      dataEmMilis: Object

    },
    domReady: function() {
      console.log("dom");
    },
    ready: function() {
      console.log("-"+this.dataDaMamada)
      var dataAtual = new Date();
      this.dataDaMamada = this.formataData(dataAtual);
      this.tempoDaMamada = 0;
      this.tempoDaMamadaString = '1:00 minuto';
      var minutos = dataAtual.getMinutes()<10?'0'+dataAtual.getMinutes():dataAtual.getMinutes();
      this.horaDaMamada = dataAtual.getHours() + ':' + minutos; 


    },

    formataData: function(data) {
      
      var dd = data.getDate();
      var mm = data.getMonth()+1; 

      var yyyy = data.getFullYear();
      if(dd<10){
          dd='0'+dd
      } 
      if(mm<10){
          mm='0'+mm
      } 
      var data = dd+'-'+mm+'-'+yyyy;
      return data;
    },

    mudaValor: function () {
      this.tempoDaMamadaString = ""+ this.tempoDaMamada +":00 " + (this.tempoDaMamada==1?"minuto": "minutos");
    },

    handleAjax: function (e, detail, sender) {

      console.log('oi -'+detail.response);

    },

    stringDateToMilis: function (stringDate) {
      var splitData = stringDate.split(" ");
      var diaMesAno = splitData[0];
      var horaMinuto = splitData[1];

      return new Date(diaMesAno.split("-")[2],diaMesAno.split("-")[1],diaMesAno.split("-")[0],horaMinuto.split(":")[0],horaMinuto.split(":")[1],00).getTime();
    },

    adicionarMamada: function () {
        this.body = '{"dataHoraDaMamada": "'+ this.dataDaMamada+ ' '+ this.horaDaMamada +'", "mama":"'+ this.mama+'", "duracaoDaMamada":"'+this.tempoDaMamadaString.split(" ")[0] +'", "user":"mariaalice"}';
        this.url = 'http://localhost:9200/mamadas/mamada/mariaalice'+this.stringDateToMilis(this.dataDaMamada+ ' '+ this.horaDaMamada);
        this.$.ajaxMamada.generateRequest();
        document.getElementById("listaMamadasAjax").generateRequest();
                
    }

  });
})();
</script>
